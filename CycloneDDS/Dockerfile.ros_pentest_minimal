# -------------------------------------------------------------------
#  Ubuntu Jammy (22.04) Tabanlı: Minimal ROS 2 + CycloneDDS + Pentest Araçları
# -------------------------------------------------------------------
FROM ubuntu:22.04

LABEL maintainer="senin_adresin@example.com"

ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=Europe/Istanbul

# 1) Sistem saat dilimini ayarlayıp temel paketleri yükleyelim
RUN ln -fs /usr/share/zoneinfo/$TZ /etc/localtime && \
    apt-get update && apt-get install -y --no-install-recommends \
      curl \
      gnupg2 \
      lsb-release \
      wget \
      python3 \
      python3-pip \
      python3-setuptools \
      net-tools \
      iputils-ping \
      iproute2 \
      vim \
      htop \
      sudo \
      git \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# 2) ROS 2 Humble APT Kaynağını ekleyelim (jammy için)
RUN curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc \
      | gpg --dearmor -o /usr/share/keyrings/ros-archive-keyring.gpg && \
    echo "deb [signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu jammy main" \
      > /etc/apt/sources.list.d/ros2-latest.list

# 3) ROS 2 ve CycloneDDS paketlerini yükleyelim
RUN apt-get update && apt-get install -y --no-install-recommends \
      ros-humble-ros-base \
      ros-humble-rmw-cyclonedds-cpp \
      ros-humble-cyclonedds \
      ros-humble-demo-nodes-cpp \
      ros-humble-demo-nodes-py \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# 4) Temel pentest / ağ araçlarını yükleyelim
#   - tcpdump     : Paket yakalama
#   - tshark      : Paket analizi
#   - arp-scan    : Alt ağ taraması
#   - dsniff      : içinde 'arpspoof' var
#   - ettercap-text-only : DNS/ARP spoof,
#   - scapy (Python) : Paket manipülasyonu (scriptler için)
RUN apt-get update && apt-get install -y --no-install-recommends \
      nmap \
      tcpdump \
      tshark \
      arp-scan \
      dsniff \
      ettercap-text-only \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# 5) Python kütüphanelerini (Scapy + ROS 2 derleme araçları) kuralım
RUN pip3 install --no-cache-dir \
      scapy \
      colcon-common-extensions \
      empy \
      pandas

# 6) /home/ros kullanıcı dizinini oluşturup kullanıcıya geçelim (opsiyonel)
RUN useradd -m -s /bin/bash ros && \
    echo "ros:ros" | chpasswd && \
    adduser ros sudo

USER ros
WORKDIR /home/ros

# 7) Başlangıçta bash inşa et
CMD ["/bin/bash"]

